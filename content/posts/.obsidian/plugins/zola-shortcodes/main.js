/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var D=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var H=Object.prototype.hasOwnProperty;var L=(n,i)=>{for(var t in i)D(n,t,{get:i[t],enumerable:!0})},W=(n,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of M(i))!H.call(n,o)&&o!==t&&D(n,o,{get:()=>i[o],enumerable:!(e=O(i,o))||e.enumerable});return n};var k=n=>W(D({},"__esModule",{value:!0}),n);var q={};L(q,{default:()=>y});module.exports=k(q);var a=require("obsidian"),E=require("@codemirror/state"),l=require("@codemirror/view"),S=class extends l.WidgetType{constructor(t,e,o){super();this.tag=t,this.src=e,this.filePath=o}eq(t){return t.src===this.src&&t.filePath===this.filePath}toDOM(t){let e=document.createElement(this.tag);return e.setAttr("src",this.src),e.setAttr("data-path",this.filePath),this.tag=="video"&&(e.setAttr("controls",""),e.setAttr("preload","metadata")),e}ignoreEvent(t){return!1}},T=class extends l.WidgetType{constructor(t,e){super();this.type=t,this.text=e}eq(t){return t.type===this.type&&t.text===this.text}toDOM(t){let e=document.createElement("div");return e.setAttr("class","callout"),e.setAttr("data-callout",this.type),this.text.setAttr("class","callout-content"),e.appendChild(this.text),e}ignoreEvent(t){return!1}},R=/{{\s*(img|video)\(src="([\/\.\w\- ]+)".*}}/g,V=/^{%\s*(info|tip|warning|danger)\(\)\s*%}(.*){%\s*end\s*%}$/g;function B(n){return E.StateField.define({create(i){return l.Decoration.none},update(i,t){var x,c;let e=new E.RangeSetBuilder;if(t.state.field(a.editorLivePreviewField)){let r=t.state.field(a.editorInfoField),h=t.state.selection.main,v=t.state.doc,b=0,C=t.state.doc.length;for(let g=v.iterRange(b,C),u=b,s;!g.next().done;u+=g.value.length)if(!g.lineBreak){if(g.value[0]!="{")continue;for(;s=R.exec(g.value);){let w=s[1],P=s[2],f=u+s.index,p=u+s.index+s[0].length;if(r.file){let m=n.app.metadataCache.getFirstLinkpathDest(P,r.file.path);if(m){let F=n.app.vault.getResourcePath(m)+"?"+m.stat.mtime;h.from<f||h.to>p?e.add(f,p,l.Decoration.replace({widget:new S(w,F,m.path)})):e.add(p,p,l.Decoration.widget({widget:new S(w,F,m.path)}))}}}for(;s=V.exec(g.value);){let w=s[1],P=s[2],f=u+s.index,p=u+s.index+s[0].length;if(h.from<f||h.to>p){var d=document.createElement("span");a.MarkdownRenderer.render(this.app,P,d,(c=(x=r.file)==null?void 0:x.path)!=null?c:"",new a.Component),e.add(f,p,l.Decoration.replace({widget:new T(w,d)}))}}}}return e.finish()},provide(i){return l.EditorView.decorations.from(i)}})}var I={convertOnPaste:!0},y=class extends a.Plugin{constructor(){super(...arguments);this.pasteHandler=async(t,e)=>{if(t.defaultPrevented||!this.settings.convertOnPaste||t.clipboardData===null)return;let d=t.clipboardData.files;if(!(d.length==0||!Array.from(d).every(c=>c.type.startsWith("image/")||c.type.startsWith("video/")))){t.preventDefault();for(let c=0;c<d.length;c++){let r=d[c];if(r.type.startsWith("image/")||r.type.startsWith("video/")){let h=await this.app.fileManager.getAvailablePathForAttachment(r.name),v=await this.app.vault.createBinary(h,await r.arrayBuffer());r.type.startsWith("image/")?e.replaceSelection('{{ img(src="'+v.name+`", alt="" link="") }}
`):r.type.startsWith("video/")&&e.replaceSelection('{{ video(src="'+v.name+`") }}
`)}}}}}async onload(){await this.loadSettings(),this.addSettingTab(new A(this.app,this)),this.registerEditorExtension(B(this)),this.app.workspace.on("editor-paste",this.pasteHandler)}onunload(){this.app.workspace.off("editor-paste",this.pasteHandler)}async loadSettings(){this.settings=Object.assign({},I,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},A=class extends a.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new a.Setting(t).setName("Convert on Paste").setDesc("Convert images and videos on paste into zola shortcodes").addToggle(e=>e.setValue(this.plugin.settings.convertOnPaste).onChange(async o=>{this.plugin.settings.convertOnPaste=o,await this.plugin.saveSettings()}))}};
